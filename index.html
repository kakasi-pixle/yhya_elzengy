<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>اقتل الزنوج</title>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: #001022;
  touch-action: none;
  font-family: Arial, sans-serif;
}
canvas {
  display: block;
}
#joystick {
  position: fixed;
  bottom: 40px;
  left: 40px;
  width: 120px;
  height: 120px;
  border-radius: 50%;
  background: rgba(255,255,255,0.2);
}
#stick {
  position: absolute;
  left: 40px;
  top: 40px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: #fff;
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<div id="joystick">
  <div id="stick"></div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

// الصور
const mainImage = new Image();
mainImage.src = "zen.png"; // الصورة الكبيرة عند الفوز

const enemyImage = new Image();
enemyImage.src = "zen1.png"; // صورة العدو

// اللاعب
let player = { x: canvas.width/2, y: canvas.height-160, size: 25 };

// المتغيرات
let enemies = [];
let lasers = [];
let killed = 0;
let spawned = 0;
let gameWon = false;

// حجم أكبر للأعداء
const enemySize = 80;

// سباون عدو واحد فقط (حد أقصى 10)
function spawnEnemy() {
  if (spawned < 10) {
    enemies.push({ x: Math.random()*(canvas.width-enemySize)+enemySize/2, y: -enemySize, size: enemySize, alive:true });
    spawned++;
  }
}

// سباون تدريجي
setInterval(()=>{if(!gameWon) spawnEnemy();},900);

// ضرب تلقائي
setInterval(()=>{if(!gameWon) lasers.push({x:player.x,y:player.y});},400);

// Joystick
const joystick = document.getElementById("joystick");
const stick = document.getElementById("stick");
let joyX=0, joyY=0, joyActive=false;

joystick.addEventListener("touchstart",()=>joyActive=true);
joystick.addEventListener("touchend",()=>{joyActive=false; joyX=joyY=0; stick.style.left="40px"; stick.style.top="40px";});
joystick.addEventListener("touchmove", e=>{
  if(!joyActive) return;
  let rect = joystick.getBoundingClientRect();
  let x = e.touches[0].clientX - rect.left -60;
  let y = e.touches[0].clientY - rect.top -60;
  let dist = Math.min(40, Math.hypot(x,y));
  let angle = Math.atan2(y,x);
  joyX = Math.cos(angle)*dist/40;
  joyY = Math.sin(angle)*dist/40;
  stick.style.left = 40+joyX*40+"px";
  stick.style.top = 40+joyY*40+"px";
});

// صور صغيرة متحركة عند الفوز
let flyingSmallImages = [];
for(let i=0;i<12;i++){ // عدد أكبر من قبل
  flyingSmallImages.push({
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height,
    angle: Math.random()*2*Math.PI,
    speed: 1 + Math.random()*2,
    size: 80
  });
}

function update(){
  if(!gameWon){
    player.x += joyX*6;
    player.y += joyY*6;

    enemies.forEach(e=>{if(e.alive)e.y+=1.6;});

    lasers.forEach((l,i)=>{
      l.y-=12;
      enemies.forEach(e=>{
        if(e.alive && Math.abs(l.x-e.x)<e.size && Math.abs(l.y-e.y)<e.size){
          e.alive=false;
          killed++;
        }
      });
      if(l.y<0) lasers.splice(i,1);
    });

    if(killed===10){
      gameWon=true;
    }
  } else {
    // تحديث موقع الصور الصغيرة عند الفوز (تطير في مسار دائري)
    flyingSmallImages.forEach(img=>{
      img.x += Math.cos(img.angle)*img.speed;
      img.y += Math.sin(img.angle)*img.speed;

      // ابعاد الشاشة
      if(img.x<0) img.x=canvas.width;
      if(img.x>canvas.width) img.x=0;
      if(img.y<0) img.y=canvas.height;
      if(img.y>canvas.height) img.y=0;
    });
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // اللاعب (سفينة أرقى)
  ctx.save();
  ctx.translate(player.x, player.y);

  // شكل سفينة متطور: جسم مركزي + جناحين + شعاع أمامي
  ctx.fillStyle = "#00ffcc";
  ctx.strokeStyle = "#00ffff";
  ctx.lineWidth = 3;
  ctx.beginPath();
  ctx.ellipse(0,0, player.size, player.size/1.5, 0, 0, Math.PI*2);
  ctx.fill();
  ctx.stroke();

  // الجناح الأيسر
  ctx.beginPath();
  ctx.moveTo(-player.size,0);
  ctx.lineTo(-player.size-15,5);
  ctx.lineTo(-player.size-15,-5);
  ctx.closePath();
  ctx.fill();
  ctx.stroke();

  // الجناح الأيمن
  ctx.beginPath();
  ctx.moveTo(player.size,0);
  ctx.lineTo(player.size+15,5);
  ctx.lineTo(player.size+15,-5);
  ctx.closePath();
  ctx.fill();
  ctx.stroke();

  // الشعاع الأمامي
  ctx.beginPath();
  ctx.moveTo(0,-player.size*1.2);
  ctx.lineTo(0,-player.size*2);
  ctx.strokeStyle="#00ffff";
  ctx.lineWidth=4;
  ctx.stroke();

  ctx.restore();

  // الأعداء (صور أكبر)
  enemies.forEach(e=>{
    if(e.alive){
      ctx.drawImage(enemyImage, e.x - e.size/2, e.y - e.size/2, e.size, e.size);
    }
  });

  // الليزر
  ctx.strokeStyle="#00ffff";
  ctx.lineWidth=6;
  lasers.forEach(l=>{ctx.beginPath(); ctx.moveTo(l.x,l.y); ctx.lineTo(l.x,l.y-50); ctx.stroke();});

  // شاشة الفوز
  if(gameWon){
    // الصورة الكبيرة
    ctx.drawImage(mainImage, canvas.width/2 - 350, canvas.height/2 - 350, 700, 700);

    // صور صغيرة متحركة حول الشاشة
    flyingSmallImages.forEach(img=>{
      ctx.drawImage(mainImage, img.x - img.size/2, img.y - img.size/2, img.size, img.size);
    });
  }
}

function loop(){ update(); draw(); requestAnimationFrame(loop); }
loop();
</script>

</body>
</html>
