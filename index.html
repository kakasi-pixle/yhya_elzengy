<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø§Ù‚ØªÙ„ Ø§Ù„Ø²Ù†ÙˆØ¬</title>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: black;
  touch-action: none;
}
canvas {
  display: block;
  background: #001;
}
#joystick {
  position: fixed;
  bottom: 40px;
  left: 40px;
  width: 120px;
  height: 120px;
  border-radius: 50%;
  background: rgba(255,255,255,0.25);
}
#stick {
  position: absolute;
  left: 40px;
  top: 40px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: white;
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<div id="joystick">
  <div id="stick"></div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

// ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ø§Ù„ÙÙˆØ² Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©
const winImage = new Image();
winImage.src = "https://qu.ax/tMWYs";

// Ø§Ù„Ù„Ø§Ø¹Ø¨
let player = {
  x: canvas.width / 2,
  y: canvas.height - 160,
  size: 20
};

// Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
let enemies = [];
let lasers = [];
let killed = 0;
let spawned = 0;
let gameWon = false;

// Ø³Ø¨Ø§ÙˆÙ† Ø¹Ø¯Ùˆ ÙˆØ§Ø­Ø¯ ÙˆØ§Ø­Ø¯ (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 10)
function spawnEnemy() {
  if (spawned < 10) {
    enemies.push({
      x: Math.random() * (canvas.width - 60) + 30,
      y: -40,
      size: 30,
      alive: true
    });
    spawned++;
  }
}

// Ø³Ø¨Ø§ÙˆÙ† ØªØ¯Ø±ÙŠØ¬ÙŠ
setInterval(() => {
  if (!gameWon) spawnEnemy();
}, 900);

// Ø¶Ø±Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠ (Ù„ÙŠØ²Ø±)
setInterval(() => {
  if (!gameWon) {
    lasers.push({ x: player.x, y: player.y });
  }
}, 400);

// ğŸ® Joystick
const joystick = document.getElementById("joystick");
const stick = document.getElementById("stick");
let joyX = 0, joyY = 0;
let joyActive = false;

joystick.addEventListener("touchstart", () => joyActive = true);
joystick.addEventListener("touchend", () => {
  joyActive = false;
  joyX = joyY = 0;
  stick.style.left = "40px";
  stick.style.top = "40px";
});

joystick.addEventListener("touchmove", e => {
  if (!joyActive) return;
  let rect = joystick.getBoundingClientRect();
  let x = e.touches[0].clientX - rect.left - 60;
  let y = e.touches[0].clientY - rect.top - 60;
  let dist = Math.min(40, Math.hypot(x, y));
  let angle = Math.atan2(y, x);
  joyX = Math.cos(angle) * dist / 40;
  joyY = Math.sin(angle) * dist / 40;
  stick.style.left = 40 + joyX * 40 + "px";
  stick.style.top = 40 + joyY * 40 + "px";
});

function update() {
  // Ø­Ø±ÙƒØ© Ø§Ù„Ù„Ø§Ø¹Ø¨
  player.x += joyX * 6;
  player.y += joyY * 6;

  // Ø­Ø±ÙƒØ© Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡
  enemies.forEach(e => {
    if (e.alive) e.y += 1.6;
  });

  // Ø§Ù„Ù„ÙŠØ²Ø± + Ø§Ù„ØªØµØ§Ø¯Ù…
  lasers.forEach((l, i) => {
    l.y -= 12;
    enemies.forEach(e => {
      if (
        e.alive &&
        Math.abs(l.x - e.x) < e.size &&
        Math.abs(l.y - e.y) < e.size
      ) {
        e.alive = false;
        killed++;
      }
    });
    if (l.y < 0) lasers.splice(i, 1);
  });

  if (killed === 10) gameWon = true;
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Ø§Ù„Ù„Ø§Ø¹Ø¨ (Ù…Ø«Ù„Ø«)
  ctx.fillStyle = "lime";
  ctx.beginPath();
  ctx.moveTo(player.x, player.y - 20);
  ctx.lineTo(player.x - 20, player.y + 20);
  ctx.lineTo(player.x + 20, player.y + 20);
  ctx.fill();

  // Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡ (Ù…Ø±Ø¨Ø¹Ø§Øª)
  enemies.forEach(e => {
    if (e.alive) {
      ctx.fillStyle = "red";
      ctx.fillRect(e.x - 15, e.y - 15, 30, 30);
    }
  });

  // Ø§Ù„Ù„ÙŠØ²Ø± (Ø´Ø¹Ø§Ø¹)
  ctx.strokeStyle = "cyan";
  ctx.lineWidth = 6;
  lasers.forEach(l => {
    ctx.beginPath();
    ctx.moveTo(l.x, l.y);
    ctx.lineTo(l.x, l.y - 45);
    ctx.stroke();
  });

  // Ø´Ø§Ø´Ø© Ø§Ù„ÙÙˆØ²
  if (gameWon) {
    ctx.fillStyle = "white";
    ctx.font = "60px Arial";
    ctx.textAlign = "center";
    ctx.fillText("Ù„Ù‚Ø¯ ÙØ²Øª", canvas.width / 2, canvas.height / 2 - 220);

    // Ø§Ù„ØµÙˆØ±Ø© ØªØ­Øª Ø§Ù„ÙƒÙ„Ù…Ø© ÙˆÙƒØ¨ÙŠØ±Ø©
    ctx.drawImage(
      winImage,
      canvas.width / 2 - 250,
      canvas.height / 2 - 180,
      500,
      500
    );
  }
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
