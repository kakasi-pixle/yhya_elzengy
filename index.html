<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>لعبة السفينة</title>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: #001022;
  touch-action: none;
}
canvas {
  display: block;
}
#joystick {
  position: fixed;
  bottom: 40px;
  left: 40px;
  width: 120px;
  height: 120px;
  border-radius: 50%;
  background: rgba(255,255,255,0.2);
}
#stick {
  position: absolute;
  left: 40px;
  top: 40px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: #fff;
}
</style>
</head>

<body>
<canvas id="game"></canvas>

<div id="joystick">
  <div id="stick"></div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

// الصور
const winImage = new Image();
winImage.src = "zen.png";

const enemyImage = new Image();
enemyImage.src = "zen1.png";

// اللاعب
let player = {
  x: canvas.width / 2,
  y: canvas.height - 140,
  size: 22
};

// متغيرات
let enemies = [];
let lasers = [];
let killed = 0;
let spawned = 0;
let gameWon = false;

const enemySize = 90;

// أعداء
function spawnEnemy() {
  if (spawned < 10) {
    enemies.push({
      x: Math.random() * (canvas.width - enemySize) + enemySize / 2,
      y: -enemySize,
      size: enemySize,
      alive: true
    });
    spawned++;
  }
}

setInterval(() => { if (!gameWon) spawnEnemy(); }, 900);

// ضرب تلقائي
setInterval(() => {
  if (!gameWon) lasers.push({ x: player.x, y: player.y });
}, 350);

// Joystick
const joystick = document.getElementById("joystick");
const stick = document.getElementById("stick");
let joyX = 0, joyY = 0, active = false;

joystick.addEventListener("touchstart", () => active = true);
joystick.addEventListener("touchend", () => {
  active = false;
  joyX = joyY = 0;
  stick.style.left = "40px";
  stick.style.top = "40px";
});

joystick.addEventListener("touchmove", e => {
  if (!active) return;
  let r = joystick.getBoundingClientRect();
  let x = e.touches[0].clientX - r.left - 60;
  let y = e.touches[0].clientY - r.top - 60;
  let d = Math.min(40, Math.hypot(x, y));
  let a = Math.atan2(y, x);
  joyX = Math.cos(a) * d / 40;
  joyY = Math.sin(a) * d / 40;
  stick.style.left = 40 + joyX * 40 + "px";
  stick.style.top = 40 + joyY * 40 + "px";
});

// صور الفوز المتحركة
let flyingImages = [];
for (let i = 0; i < 16; i++) {
  flyingImages.push({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    a: Math.random() * Math.PI * 2,
    s: 1 + Math.random() * 2,
    size: 90
  });
}

function update() {
  if (!gameWon) {
    player.x += joyX * 6;
    player.y += joyY * 6;

    // حدود
    player.x = Math.max(player.size, Math.min(canvas.width - player.size, player.x));
    player.y = Math.max(player.size, Math.min(canvas.height - player.size, player.y));

    enemies.forEach(e => e.alive && (e.y += 1.6));

    lasers.forEach((l, i) => {
      l.y -= 14;
      enemies.forEach(e => {
        if (e.alive && Math.abs(l.x - e.x) < e.size / 2 && Math.abs(l.y - e.y) < e.size / 2) {
          e.alive = false;
          killed++;
        }
      });
      if (l.y < 0) lasers.splice(i, 1);
    });

    if (killed === 10) gameWon = true;
  } else {
    flyingImages.forEach(f => {
      f.x += Math.cos(f.a) * f.s;
      f.y += Math.sin(f.a) * f.s;
      if (f.x < 0) f.x = canvas.width;
      if (f.x > canvas.width) f.x = 0;
      if (f.y < 0) f.y = canvas.height;
      if (f.y > canvas.height) f.y = 0;
    });
  }
}

function drawShip() {
  ctx.save();
  ctx.translate(player.x, player.y);

  ctx.fillStyle = "#00e6ff";
  ctx.strokeStyle = "#00ffff";
  ctx.lineWidth = 3;

  ctx.beginPath();
  ctx.moveTo(0, -player.size * 2);
  ctx.lineTo(player.size * 1.2, player.size * 1.5);
  ctx.lineTo(player.size * 0.6, player.size);
  ctx.lineTo(0, player.size * 1.3);
  ctx.lineTo(-player.size * 0.6, player.size);
  ctx.lineTo(-player.size * 1.2, player.size * 1.5);
  ctx.closePath();
  ctx.fill();
  ctx.stroke();

  ctx.beginPath();
  ctx.arc(0, player.size * 1.9, player.size * 0.4, 0, Math.PI * 2);
  ctx.fillStyle = "#00ffff";
  ctx.fill();

  ctx.restore();
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  drawShip();

  enemies.forEach(e => {
    if (e.alive)
      ctx.drawImage(enemyImage, e.x - e.size / 2, e.y - e.size / 2, e.size, e.size);
  });

  ctx.strokeStyle = "#00ffff";
  ctx.lineWidth = 6;
  lasers.forEach(l => {
    ctx.beginPath();
    ctx.moveTo(l.x, l.y);
    ctx.lineTo(l.x, l.y - 60);
    ctx.stroke();
  });

  if (gameWon) {
    ctx.drawImage(winImage, canvas.width / 2 - 350, canvas.height / 2 - 350, 700, 700);
    flyingImages.forEach(f =>
      ctx.drawImage(winImage, f.x - f.size / 2, f.y - f.size / 2, f.size, f.size)
    );
  }
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
